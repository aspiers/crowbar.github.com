<!doctype html>
<html>
  
  <head>
    <title>Building your own ISO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link href="/css/genericons.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/bootstrap-responsive.css">
    <link rel="stylesheet" href="/themes/inspiritas/inspiritas.css">
    <link rel="stylesheet" href="https://djyhxgczejc94.cloudfront.net/builds/80037b02082b29f5f9cea127cab2a4ba4365ec67.css">
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
  </head>
  
  <body>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/bootstrap-responsive.css">
    <link rel="stylesheet" href="/themes/inspiritas/inspiritas.css">
    <link rel="stylesheet" href="https://djyhxgczejc94.cloudfront.net/builds/80037b02082b29f5f9cea127cab2a4ba4365ec67.css">
    <link rel="stylesheet" href="/css/divshot-util.css">
    <link rel="stylesheet" href="/css/divshot-canvas.css">
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/home.html"><img src="/images/crowbar-white.png" class="pull-left"></a>
          <div class="navbar-content">
            <ul class="nav">
              <li >
                <a href="/home.html">Home</a> 
              </li>
              <li class="active">
                <a href="/docs/getting-help.html">Docs</a> 
              </li>
              <li >
                <a href="/issues.html">Issues</a> 
              </li>
              <li >
                <a href="javascript:void(0);" onclick="alert('Coming Soon')">Screenshots</a> 
              </li>
            </ul>
          </div>
          <a href="/download/" class="btn pull-right btn-success btn-large">Download</a>
        </div>
      </div>
    </div>

    <div class="container">
<!--      <a class="btn btn-large btn-primary btn-block visible-phone" href="#"><span class="btn-label">Sign Up Today!</span></a> -->
      <div class="row">
        <div class="span4">
          <ul class="nav nav-stacked nav-list">
            <li class="nav-header">USERS</li>
            <li>
              <a href="/docs/getting-started/">Getting Started</a>
                
            </li>

<!--            <li>
              <a href="#">User Guide</a> 
            </li>
            <li>
              <a href="#">Deployment Guide</a> 
            </li>
            <li>
              <a href="#">Troubleshooting</a> 
            </li>
            <li class="divider"></li>
-->
            <li class="nav-header">DEVELOPERS</li>
<!--            <li>
              <a href="#">Development Guide</a> 
            </li>
            <li>
              <a href="#">Barclamps</a> 
            </li>
-->
            <li>
              <a href="/docs/build-crowbar.html">Building an ISO</a> 
            </li>
            <li>
              <a href="/docs/testing.html">Testing</a> 
            </li>
<!--            <li>
              <a href="#">Contributing</a> 
            </li>
-->
            <li class="divider"></li>
<!-- TODO: fix this           <li class="active">
              <a href="#">Getting Help</a> 
            </li>
-->
            <li>
              <a href="/docs/getting-help.html">Getting Help</a> 
            </li>

            <li>
              <a href="/docs/faq.html">FAQ</a> 
            </li>
<!--            <li>
              <a href="#">Release Notes</a> 
            </li>
-->
          </ul>
        </div>
        <div class="span8">
          <p></p>
		      
    <a title="Edit this document (requires Github Sign-In)" class="pull-left" href="https://github.com/crowbar/barclamp-crowbar/edit/master/doc/devguide/devtool-build.md">
        <span class="btn-label edit-icon"></span>
    </a>
    <!-- <div class="edit-icon">You're a Star!</div> -->
 
 <h2 id='building_your_own_crowbariso__for_developers'>Building your own Crowbar.iso - (for developers)</h2>

<p>Changes effective 9/14/2012: <em>Applies to Crowbar 1.5+ &amp; Crowbar 2.x Deployment</em></p>

<p>The Crowbar Dev Tool is a git overlay that helps manage Crowbar releases, barclamp integration, and gated checkins to the Crowbar source base.</p>

<p>This page documents how to use the dev tool to build the Crowbar ISO. For more detailed documentation specifically on how to use the tool for regular development, see <a href='https://github.com/crowbar/crowbar/blob/master/README.dev-and-workflow'>README.dev-and-workflow</a> in the main crowbar git repository.</p>

<p>If you are planning to write code for Crowbar core or develop a barclamp, we highly recommend you follow the following steps to create your build server. If you are NOT planning to edit Crowbar then include the <code>--no-github</code> flag or follow the read-only <span><span>Build-Crowbar.ISO</span></span> instructions.</p>

<p>Tip: Want to watch it on video? http://youtu.be/vIQLK4MXcqg</p>

<h3 id='prerequisites'>Pre-requisites:</h3>

<ul>
<li>
<p>A GitHub account (https://github.com/). They are free for personal open source use.</p>
</li>

<li>
<p>A 40GB Ubuntu 12.04.1 server (VM is ok) is recommended for this process!</p>

<ul>
<li><code>sudo apt-get update</code> before taking any other steps (+ coffee break)</li>

<li>You&#8217;ll like want to <code>sudo apt-get install openssh-server</code> so you can access it</li>
</ul>
</li>

<li>
<p>It is important to use the dev tool for managing branches &amp; releases because it:</p>

<ul>
<li>takes care of synchronization with all the barclamps</li>

<li>builds nested tags with the release information</li>
</ul>
</li>

<li>
<p>A copy of your target Crowbar OS.<br /> * This page uses Ubuntu 12.04.1 server x64 iso as the example</p>
</li>

<li>
<p><code>sudo sed -ie &quot;s/%admin ALL=(ALL) ALL/%admin ALL=(ALL) NOPASSWD: ALL/g&quot; /etc/sudoers</code></p>

<ul>
<li>note: this will allow passwordless sudo for users in the admin group. The build process performs some high level kung-fu, some of which requires root access. if running as non-root, you&#8217;ll be prompted for password unless you setup Passwordless SUDO permissions for your user.</li>

<li>if the above does not work, using your username instead of &#8216;crowbar&#8217;, try <code>echo &#39;crowbar ALL=(ALL) NOPASSWD: ALL&#39; &gt;/etc/sudoers.d/crowbar; chmod 400 /etc/sudoers.d/crowbar</code></li>

<li>Alternatively run the build as root.</li>
</ul>
</li>
</ul>

<h3 id='build_steps'>Build Steps:</h3>

<p><em>note:</em> use sudo as instructed. Do not use the Dev tool as root!</p>

<ol>
<li>
<p>If you don&#8217;t want to use HTTPS, then make sure that your build server&#8217;s public key is registered with your Github account</p>
</li>

<li>
<p><code>sudo apt-get update</code></p>
</li>

<li>
<p><code>sudo apt-get install git rpm ruby rubygems1.8 curl build-essential debootstrap mkisofs binutils markdown erlang debhelper db-make python-pip</code></p>
</li>

<li>
<p><code>sudo apt-get install build-essential libopenssl-ruby1.8 libssl-dev zlib1g-dev</code></p>
</li>

<li>
<p>Do NOT change your ruby configuration (yet). Keep it 3.8.7 auto for now. <span>Ignore - <code>sudo update-alternatives --config ruby</code> (to make Ruby 1.9.1 the default. ruby -v will report version 1.9.3)</span></p>
</li>

<li>
<p><code>sudo gem install json net-http-digest_auth kwalify bundler rake rcov rspec</code></p>
</li>

<li>
<p><code>git clone https://github.com/crowbar/crowbar.git</code></p>
</li>

<li>
<p><code>cd ~/crowbar</code> directory</p>
</li>

<li>
<p><code>./dev setup</code></p>

<ol>
<li>You can ignore warnings: &#8220;ulimit: open files: cannot modify limit: Invalid argument&#8221;</li>

<li>this will create personal github forks for you of all the Crowbar modules. If you don&#8217;t have a Github login, or you don&#8217;t care about pushing changes back upstream, you can run <code>./dev setup --no-github</code></li>
</ol>
</li>

<li>
<p>optional, if this is a new system, set your user information as directed</p>

<ol>
<li>git config &#8211;global user.name &#8220;Your Name&#8221;</li>

<li>git config &#8211;global user.email you@example.com</li>
</ol>
</li>

<li>
<p><code>./dev fetch</code></p>
</li>

<li>
<p><code> sudo ./build_sledgehammer.sh</code></p>

<ol>
<li>this builds the &#8220;discovery image&#8221; called Sledgehammer.</li>

<li>this step take a long time. It helps if you&#8217;ve pre-fetched the CentOS ISO (see <span><span>Build-Crowbar.ISO</span></span>)</li>

<li>It does not change often and does not need to be repeated once it has been built.</li>
</ol>
</li>

<li>
<p>sudo ln -s /usr/share/debootstrap/scripts/gutsy /usr/share/debootstrap/scripts/precise 1. note: This is required only if: You&#8217;re building for 12.04 on a 11.04 or 11.10 machine, since those versions don&#8217;t know how to build Precise</p>
</li>

<li>
<p>Make sure you have the right ISOs in <code>~/.crowbar-build-cache/iso</code> directory 1. For Ubuntu, you should have http://old-releases.ubuntu.com/releases/12.04.1/ubuntu-12.04.1-server-amd64.iso 1. <code>cd ~/.crowbar-build-cache/iso</code> 1. <code>wget http://old-releases.ubuntu.com/releases/12.04.1/ubuntu-12.04.1-server-amd64.iso</code></p>
</li>

<li>
<p><code>./dev switch development</code></p>

<ol>
<li>you can see all the releases with ./dev releases</li>

<li>choices trunk (default, trunk), 1.2 = fledermaus, 1.3 Cloudera = elefante</li>
</ol>
</li>

<li>
<p><code>./dev checkout master</code></p>

<ol>
<li>you can see all the branches with git branch -a</li>

<li>choices are <code>master</code> (default, trunk), <code>openstack-os-build</code> (OpenStack), <code>cloudera-os-build</code> (Hadoop)</li>

<li>different branches represent different &#8220;distros&#8221; which combine different sets of barclamps (e.g. openstack, hadoop)</li>
</ol>
</li>

<li>
<p><code>./dev build --os ubuntu-12.04 --update-cache</code></p>

<ol>
<li>The parameter &#8211;update-cache will create your Build Cache at this time, thus the first run will download from the internet what it needs. This takes time and can be skipped for later builds. Dev Tool will tell you if your cache is need to be updated</li>

<li>you can add &#8211;release development &#8211;branch master if you did not switch or checkout</li>
</ol>
</li>
</ol>

<h3 id='special_notes_for_using_a_build_vm'>Special Notes for Using a Build VM</h3>

<p>If you are using VMware Worktation (or similar) then these extra tips will help you improve your build experience</p>

<p>Tips:</p>

<ul>
<li>
<p>VMware tools are not working on Ubuntu 12.04 at this time (5.5.2012) so use 11.10</p>
</li>

<li>
<p>To save space on your VM, you can use ISOs that are local to your host</p>

<ul>
<li>create a shared file location (e.g.: c:\isos) mounted to &#8220;isos&#8221;</li>

<li><code>vi ~/.build-crowbar.conf</code></li>

<li>add a reference to <code>ISO_LIBRARY=/mnt/hgfs/isos</code></li>
</ul>
</li>

<li>
<p>To make it easier to build VMs from the build ISO, have the build save it directory to your host&#8217;s drive</p>

<ul>
<li>create a shared file location (e.g.: c:\temp\crowbar) mounted to &#8220;crowbar&#8221;</li>

<li><code>vi ~/.build-crowbar.conf</code></li>

<li>add a reference to <code>ISO_DEST=/mnt/hgfs/crowbar</code></li>
</ul>
</li>
</ul>

<h3 id='building_barclamp_tars_only'>Building Barclamp TARs only</h3>

<p>If you only want barclamps for import (Utils\Import) then you should use the &#8221;&#8211;no-iso&#8221; flag with the build command. Note that you must still provide an operating system!</p>

<p>You can find the tars in ~/.crowbar-build-cache/ubuntu-12.04/build/dell/barclamps where the OS will match the one that you choose to target.</p>

<p>See <span><span>Packaging-Barclamps</span></span> about building individual barclamps.</p>

<h3 id='coding_steps'>Coding Steps</h3>

<p>We recommend you consult the ./dev command line help, and also <a href='https://github.com/crowbar/crowbar/blob/master/README.dev-and-workflow'>README.dev-and-workflow</a> in the crowbar repository.</p>

<ol>
<li>
<p>./dev backup 1. makes a copy into your personal forks (if you did not have any, you do now!)</p>
</li>

<li>
<p>./dev fetch 1. fetches changes from remote repositories, but does not make any local changes.</p>
</li>

<li>
<p>./dev sync 1. Merges changes fetched with ./dev fetch into your local branches.</p>
</li>

<li>
<p>commit your code</p>

<ol>
<li>git add</li>

<li>git commit</li>
</ol>
</li>

<li>
<p>./dev is_clean</p>
</li>

<li>
<p>./dev pull-requests-prep 1. it will give you instructions on next steps to automatically submit a push request on ALL impacted barclamps</p>
</li>
</ol>

<h3 id='build_your_cache'>Build your cache</h3>

<p>A Crowbar build contains the packages (e.g. deb,rpm,gem etc) that will be used to install your cloud. To avoid having to download the Internet on every build, the Crowbar build system maintains a local cache in ~/.crowbar-build-cache by default. Additionally, Crowbar utilizes a customized LiveCD image, SledgeHammer. You can build that too (sources on github), but it changes very infrequently - so you&#8217;re better of snatching it from somewhere.</p>
          <p></p>
        </div>
      </div>
            <div class="container-fluid">
        <img src="/images/dell-open-source.png" width="175" height="49" class="pull-right"> 
      </div>

    </div>
  </body>

</html>
