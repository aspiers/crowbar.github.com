<!doctype html>
<html>
  
  <head>
    <title>Building your own 2.x ISO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link href="/css/genericons.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/bootstrap-responsive.css">
    <link rel="stylesheet" href="/themes/inspiritas/inspiritas.css">
    <link rel="stylesheet" href="https://djyhxgczejc94.cloudfront.net/builds/80037b02082b29f5f9cea127cab2a4ba4365ec67.css">
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
  </head>
  
  <body>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/bootstrap-responsive.css">
    <link rel="stylesheet" href="/themes/inspiritas/inspiritas.css">
    <link rel="stylesheet" href="https://djyhxgczejc94.cloudfront.net/builds/80037b02082b29f5f9cea127cab2a4ba4365ec67.css">
    <link rel="stylesheet" href="/css/divshot-util.css">
    <link rel="stylesheet" href="/css/divshot-canvas.css">
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/home.html"><img src="/images/crowbar-white.png" class="pull-left"></a>
          <div class="navbar-content">
            <ul class="nav">
              <li >
                <a href="/home.html">Home</a> 
              </li>
              <li class="active">
                <a href="/docs/getting-help.html">Docs</a> 
              </li>
              <li >
                <a href="/issues.html">Issues</a> 
              </li>
              <li >
                <a href="javascript:void(0);" onclick="alert('Coming Soon')">Screenshots</a> 
              </li>
            </ul>
          </div>
          <a href="/download/" class="btn pull-right btn-success btn-large">Download</a>
        </div>
      </div>
    </div>

    <div class="container">
<!--      <a class="btn btn-large btn-primary btn-block visible-phone" href="#"><span class="btn-label">Sign Up Today!</span></a> -->
      <div class="row">
        <div class="span4">
          <ul class="nav nav-stacked nav-list">
            <li class="nav-header">USERS</li>
            <li>
              <a href="/docs/getting-started/">Getting Started</a>
                
            </li>

<!--            <li>
              <a href="#">User Guide</a> 
            </li>
            <li>
              <a href="#">Deployment Guide</a> 
            </li>
            <li>
              <a href="#">Troubleshooting</a> 
            </li>
            <li class="divider"></li>
-->
            <li class="nav-header">DEVELOPERS</li>
<!--            <li>
              <a href="#">Development Guide</a> 
            </li>
            <li>
              <a href="#">Barclamps</a> 
            </li>
-->
            <li>
              <a href="/docs/build-crowbar.html">Building an ISO (1.x)</a> 
            </li>
            <li>
              <a href="/docs/build-crowbar-2.html">Building an ISO (2.x)</a> 
            </li>
            <li>
              <a href="/docs/testing.html">Testing</a> 
            </li>
<!--            <li>
              <a href="#">Contributing</a> 
            </li>
-->
            <li class="divider"></li>
<!-- TODO: fix this           <li class="active">
              <a href="#">Getting Help</a> 
            </li>
-->
            <li>
              <a href="/docs/getting-help.html">Getting Help</a> 
            </li>

            <li>
              <a href="/docs/faq.html">FAQ</a> 
            </li>
<!--            <li>
              <a href="#">Release Notes</a> 
            </li>
-->
          </ul>
        </div>
        <div class="span8">
          <p></p>
		      
    <a title="Edit this document (requires Github Sign-In)" class="pull-left" href="https://github.com/crowbar/barclamp-crowbar/edit/master/doc/devguide/devtool-build.md">
        <span class="btn-label edit-icon"></span>
    </a>
    <!-- <div class="edit-icon">You're a Star!</div> -->
 
 
<h2 id="build_your_own_crowbar_iso_for_2x">Build your own Crowbar ISO for 2.x</h2>

<p><strong>Note:</strong> Crowbar 2.x is currently not fully functional. As a result the instructions below are only to be used by developers intending to contribute to the effort.</p>

<p>Building Crowbar is not an activity intended for users. If you simply want to download an ISO to either deploy Hadoop or OpenStack, I suggest you get one of our <a href="http://crowbar.github.io/download/">pre-compiled ISOs</a>.</p>

<p>Crowbar was originally designed to operate without any internet access, and since it includes everything needed to deploy a complete cluster, the below process will walk you through building an entire ISO which will contain all the bits in one package.</p>

<p>Unlike many projects Crowbar spans many repositories, which almost all the time need to be managed simultaneously. This means that branches or pull requests often times impact multiple repositories at once. In order to more easily manage this, we’ve created <a href="https://github.com/crowbar/crowbar/blob/master/README.dev-and-workflow">a tool called the Dev Tool</a>, which makes some of these common tasks easier.</p>

<p><strong>Note:</strong> This page documents how to use the Dev Tool to create a Crowbar ISO. For more detailed documentation specifically on how to use the tool for regular development, how to submit pull-requests, how releases are defined, please refer to the <a href="https://github.com/crowbar/crowbar/blob/master/README.dev-and-workflow">README.dev-and-workflow</a>.</p>

<h3 id="prerequisites">Pre-Requisites:</h3>

<ul>
<li>A physical or virtual Ubuntu 12.04.2 server (you will need root access)</li>

<li>An ISO of your target Crowbar OS (see instructions below on where they’ll go)
<ul>
<li>Use the <a href="http://old-releases.ubuntu.com/releases/12.04.2/ubuntu-12.04.2-server-amd64.iso">12.04.2 server ISO</a> for <strong>OpenStack</strong> builds</li>

<li>Use <a href="http://mirrors.seas.harvard.edu/centos/6.4/isos/x86_64/CentOS-6.4-x86_64-bin-DVD1.iso">CentOS 6.4 DVD ISO</a> for <strong>Hadoop</strong> builds</li>
</ul>
</li>
</ul>

<h3 id="the_dev_tool_and_github">The Dev Tool and GitHub</h3>

<p>Since all the development on Crowbar takes place on GitHub, the Dev Tool is absolutely reliant on having a reliable connection to GitHub. If you ever see console output like this: <code>......!!!.....!!!!.</code> while Dev Tool is at work, it indicates connection problems. Also, if you don’t want to use HTTPS, make sure that your build server’s public key is registered with your GitHub account.</p>

<p>If you intend on doing <em>development</em> which might result in you submitting pull- requests, you will also need a GitHub account . <strong>Note:</strong> Using your GitHub account will result in every needed Crowbar repo being forked to your account. During development it is important to use the Dev Tool for managing branches and releases.</p>

<p><strong>If you don’t have any intentions on submitting pull-requests, you can append any of the Dev Tool commands below with <code>--no-github</code>.</strong></p>

<h3 id="preparing_our_build_box">Preparing Our Build Box</h3>

<h4 id="setup_passwordless_sudo">Setup password-less sudo</h4>

<p>During the build process the Dev Tool has to perform certain tasks which require root access (mounting ISOs, etc.). In order to avoid being prompted for your password every time we will setup password-less sudo. <strong>Don’t run your build as root.</strong></p>

<pre><code># run this command to add your 
sed -ie &quot;s/%sudo\tALL=(ALL:ALL) ALL/%sudo ALL=(ALL) NOPASSWD: ALL/g&quot; /etc/sudoers</code></pre>

<h4 id="install_needed_packages_and_gems">Install needed packages and gems</h4>

<pre><code># let's install some OS packages
sudo apt-get update
sudo apt-get install git rpm ruby rubygems1.9 curl build-essential debootstrap \
mkisofs binutils markdown erlang debhelper python-pip \
build-essential libopenssl-ruby1.9 libssl-dev zlib1g-dev 
# to make Ruby 1.9.1 the default. ruby -v will report version 1.9.3
sudo update-alternatives --config ruby 
# make Gem 1.9 the default, gem -v will report version 1.9
sudo update-alternatives --config gem 

# we need Postgresql 9.3 (we rely on 9.3+ features)
# first, remove the automatically added old Posgresql
sudo apt-get remove postgresql
# now install and set to use the special port/pipe config
sudo apt-get install postgresql-9.3 pgadmin3
sudo vi /etc/postgresql/9.3/main/pg_hba.conf
  # add 'local  all   all    trust'
sudo vi /etc/postgresql/9.3/main/postgresql.conf
  # change 'port = 5439'
createuser -s -d -U crowbar
# you can test the install by making sure the following call returns
export PGCLUSTER=9.3/main
psql postgresql://crowbar@:5439/template1 -c 'select true;'


# let's install some needed gems next
sudo gem install ruby1.9.3-dev builder bluecloth
sudo gem install json net-http-digest_auth kwalify bundler delayed_job delayed_job_active_record rake rcov rspec pg --no-ri --no-rdoc</code></pre>

<h4 id="put_the_needed_base_isos_in_place">Put the needed base ISOs in place</h4>

<p>As a starting point for the build process we will need the ISOs <a href="#pre-requisites">mentioned above</a> placed where the Dev Toll can find them. The Dev Tool will then use them during the build process described below.</p>

<pre><code>mkdir -p ~/.crowbar-build-cache/iso
cd ~/.crowbar-build-cache/iso
# now scp or wget the ISOs into this directory</code></pre>

<h3 id="building_our_iso">Building Our ISO</h3>

<h4 id="checking_out_code_and_setting_up">Checking out code and setting up</h4>

<p>This next step will checkout the core Crowbar code, which includes the Dev Tool. Once the initial checkout is complete, we let the Dev Tool handle the checkout of the remaining repositories. As a result this next process will create personal forks of each Crowbar repository. If you have no interest of submitting pull requests append <code>--no-github</code>. <strong>Note:</strong> This next step will take some time.</p>

<pre><code>cd ~
git clone https://github.com/crowbar/crowbar.git
cd ~/crowbar
# append ./dev setup --no-github if you don't want to submit any pull-requests
./dev setup
# If this is your first build on the server then you will need to register your github name and email 
git config --global user.name &quot;user.name&quot;
git config --global user.email &quot;email.address&quot;
# fetch updates from configured upstream repositories
./dev fetch
# synchronize fetched updates with the local repos
./dev sync</code></pre>

<p><strong>Notes:</strong></p>

<ul>
<li>As <a href="#the-dev-tool-and-github">mentioned above</a> Dev Tool can be very taxing on GitHub and your connectivity. This means you may need to run the <code>./dev setup; ./dev fetch; ./dev sync</code> commands more than once to completely setup, fetch and sync all the repos needed. Interate these commands a few times until there is no further change. This normally takes two or three cycles when first setting up a build environment.</li>

<li>Ignore potential warnings like this: <code>ulimit: open files: cannot modify limit: Invalid argument</code></li>
</ul>

<p>If you receive any messages stating “new file: README.empty-branch” and the ./dev sync fails then run the following commands</p>

<pre><code>cd barclamps
for bc in *; do (cd &quot;$bc&quot;; git checkout master; git reset HEAD README.empty-branch); done
cd ..
find / -name README.empty-branch -delete</code></pre>

<h4 id="building_the_discovery_image">Building the discovery image</h4>

<p>During the cluster deployment Crowbar uses a special stripped down image (Sledgehammer) for node discovery. As part of our build process we also need to build Sledgehammer. This is a one time process and doesn’t need to be repeated everytime. <strong>Note:</strong> This next step will take some time.</p>

<pre><code>cd ~/crowbar
sudo ./build_sledgehammer.sh</code></pre>

<h4 id="picking_our_release_and_build">Picking our release and build</h4>

<p>Now that everything is setup and prepped, the last remaining step is to pick what we actually want to build. Several Crowbar versions and flavors (Hadoop and OpenStack) are available. Next we’re picking which version/release and flavor/build we’d like to build. <strong>It is extremely important to pick the right release and build combination.</strong> Some of the releases will be under heavy development and others will be old. If you’re unsure which one is the right one for you you should ask via <a href="http://crowbar.github.io/docs/getting-help.html">IRC or mailing list</a>.</p>

<pre><code>cd ~/crowbar

# working with releases
# show all the available releases
./dev releases

# switch to a release
./dev switch developmnet

# display your current release
./dev release


# working with builds
# show all the builds
./dev builds

# choosing a certain build
./dev build openstack-os-build

# display which build your on
./dev build</code></pre>

<p>The above results in the following viable combinations:</p>

<ul>
<li><strong>OpenStack:</strong> mesa-1.6/openstack-os-build for the latest and most stable OpenStack build based on Grizzly.</li>

<li><strong>Hadoop:</strong> hadoop-2.3/hadoop-os-build for the latest and most stable Hadoop build</li>
</ul>

<h4 id="building">Building</h4>

<p>With the above knowledge we can now kick off our Hadoop or OpenStack build.</p>

<p><strong>Note:</strong> The Dev Tool currently has a bug where it litters README.empty-branch files. Those will be problematic during <code>dev switch</code> operations. In order to <strong>clean them up run the following commands</strong> any time you run into this issue.</p>

<pre><code># clean up any .empty-branch files first
cd ~/crowbar/barclamps
for bc in *; do (cd &quot;$bc&quot;; git clean -f -x -d 1&gt;/dev/null 2&gt;&amp;1; git reset --hard 1&gt;/dev/null 2&gt;&amp;1); done </code></pre>

<p>Now we can actually kick off the build.</p>

<pre><code># FOR HADOOP
./dev switch hadoop-2.3/hadoop-os-build
./dev build --os centos-6.4 --update-cache

# FOR OPENSTACK
./dev switch mesa-1.6/openstack-os-build
./dev build --os ubuntu-12.04 --update-cache</code></pre>

          <p></p>
        </div>
      </div>
            <div class="container-fluid">
        <img src="/images/dell-open-source.png" width="175" height="49" class="pull-right"> 
      </div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2028640-4', 'crowbar.github.io');
  ga('send', 'pageview');

</script>

    </div>
  </body>

</html>
